<!DOCTYPE html>
<html lang="en">
<head>


    <meta charset="UTF-8">
    <title>Canvas Game</title>
    <style>
        .center {
            margin:     auto;
            width:      55.5%;
            padding:    0px;
        }
        html {
            background: url(Images/Layer_1.png) no-repeat center fixed;
            background-size: cover;
        }
    </style>


</head>
<body>

    <h1 align   =   "center"> Declan's Game</h1>
    <hr>

    <div class  =   "center">
        <canvas id = "canvas" width= "700" height= "500"></canvas>
    </div>



    <hr>
    <div class  = "center">
        <button id = "resetgame" onclick="resetGame()">Reset Game!</button>
    </div>


<script src = "JS/Layers.js"></script>
<script src = "JS/wolfSprite.js"></script>
<script src = "JS/Cactus.js"></script>


</body>

<script>

    function resetGame(){
      document.location.href = ""
    }

    var canvas      = document.getElementById("canvas");
    var ctx         = canvas.getContext("2d");
    var options     ={gravity:1, floor:450};
    var layers      = [];
    var actors      = [];
    var cactus      =   new Cactus(canvas);
    var game        ={canvas:canvas, obstacles:[]};
    wolf.game       = game;

    actors.push(wolf);
    actors.push(cactus);
    game.obstacles.push(cactus);

    for (var i = 1; i < 12; i++){
        layers.push(new Layer(canvas,
            "Images/Layer_" + i + ".png",
        i/4))
    }

    function drawCanvas(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for (var i = 0 ;i < 11; i++){
            layers[i].draw()
        }
        for (var j = 0; j<actors.length; j++){
            actors[j].draw(ctx);
        }
        score.draw(ctx);
    }

    function newCactus(){
        Cactus.prototype.vx     = Cactus.prototype.vx-0.3;
        cactus                  = new Cactus(canvas);
        actors.push(cactus);
        game.obstacles.push(cactus);
    }


    function tickAll(){
        for (var i = 0; i < 11; i++){
            layers[i].tick()
        }
        var deleteElems = [];
       for (var j = 0; j<actors.length; j++){
            if(actors[j].tick(canvas)){
                deleteElems.push(j);
                game.obstacles.shift();
            };
        };
        for (var k = deleteElems.length-1; k>=0 ; k--){
            console.log("deleting elem:"+deleteElems[k]);
            actors.splice(deleteElems[k],1);


            newCactus()
        }

        score.score++;
        drawCanvas();
    }

    setInterval( tickAll, 1000/25);

        window.addEventListener("keydown", function (event) {
            wolf.keyDown(event.keyCode);
    });

        window.addEventListener("keyup", function (event) {
            wolf.keyUp(event.keyCode);
    });

        ctx.font        = '25pt Calibri';
        ctx.fillStyle   = 'yellow';

        var score = {
            x:      20,
            y:      25,
            score:  0,
            draw:   scoreDraw
        };

        function scoreDraw(ctx){
            ctx.fillText("Score: " + this.score, this.x, this.y)
        }



</script>
</html>